{% extends "core/base.html" %}

{% load static %}

{% block title %}Dashboard | CanvasSync{% endblock %}

{% block breadcrumb %}Workspace / <span>Canvas Dashboard</span>{% endblock %}

{% block content %}
            <header class="settings-header">
                <h1>ðŸš€ CanvasSync Control</h1>
            </header>
            <p class="subtitle">Manage your Notion integration and secret keys below.</p>

            <div class="action-grid">
                <div class="action-card" onclick="openModal('secretsModal')">
                    <div class="card-icon">ðŸ”‘</div>
                    <div class="card-info">
                        <h3>Configure Secrets</h3>
                        <p>Set your Notion API Key and Canvas Token.</p>
                    </div>
                </div>

                <div class="action-card" onclick="openModal('dbModal')">
                    <div class="card-icon">ðŸ“Š</div>
                    <div class="card-info">
                        <h3>Database Settings</h3>
                        <p>Map properties like Due Dates and Status.</p>
                    </div>
                </div>
            </div>

            <div class="execution-section fade-in-delay">
                <hr class="notion-hr">
                <div class="action-grid">
                    <div class="action-card highlight-hover" onclick="handleAction('create')">
                        <div class="card-icon">âœ¨</div>
                        <div class="card-info">
                            <h3>Create Database</h3>
                            <p>Generate a pre-formatted Canvas board in Notion.</p>
                        </div>
                    </div>

                    <div class="action-card sync-card" onclick="handleAction('import', this)">
                        <div class="card-icon">ðŸ“¥</div>
                        <div class="card-info">
                            <h3>Import Assignments</h3>
                            <p>Fetch latest data and sync to your database.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <div id="secretsModal" class="notion-modal-overlay">
        <div class="notion-modal">
            <h2>Secret Keys</h2>
            <p class="modal-desc">These are stored securely and never shared.</p>
            <form method="post" action="{% url 'core:configure_secrets' %}">
                {% csrf_token %}
                <div class="form-group">
                    <label class="notion-label">Notion Integration Token</label>
                    <input type="password" name="notion_token" class="notion-input" placeholder="secret_..." value="{{notion_token | default:''}}">
                </div>
                <div class="form-group">
                    <label class="notion-label">Canvas API Developer Key</label>
                    <input type="password" name="canvas_token" class="notion-input" placeholder="7892~..." value="{{canvas_token | default:''}}">
                </div>
                <div class="form-group">
                    <label class="notion-label">Notion Page ID</label>
                    <input type="text" name="notion_page_id" class="notion-input" placeholder="Notion page id where DB will be created" value="{{notion_page_id | default:''}}">
                </div>
                <div class="form-group">
                    <label class="notion-label">School Domain</label>
                    <input type="text" name="school_domain" class="notion-input" placeholder="canvas.nus.edu.sg" value="{{school_domain | default:''}}">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-outline" onclick="closeModal('secretsModal')">Cancel</button>
                    <button type="submit" class="btn btn-black">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <div id="dbModal" class="notion-modal-overlay">
        <div class="notion-modal">
            <h2>Database Settings</h2>
            <p class="modal-desc">Select the properties you want to sync to Notion.</p>
            
            <form method="POST" action="{% url 'core:save_db_settings' %}">
                {% csrf_token %}
                
                <label class="notion-label">Active Properties</label>
                <div id="selected-properties-container" class="property-bar">
                    <span class="tag tag-default">Assignment</span>
                    <span class="tag tag-default">Course</span>
                    <span class="tag tag-default">Due Date</span>
                </div>

                <label class="notion-label" style="margin-top: 20px;">Available Options</label>
                <div class="property-options">
                    <div class="prop-chip" onclick="toggleProperty('Semester', 'blue')">+ Semester</div>
                    <div class="prop-chip" onclick="toggleProperty('Week', 'orange')">+ Week</div>
                    <div class="prop-chip" onclick="toggleProperty('URL', 'purple')">+ URL</div>
                    <div class="prop-chip" onclick="toggleProperty('Status', 'green')">+ Status</div>
                    <div class="prop-chip" onclick="toggleProperty('Points', 'pink')">+ Points</div>
                </div>

                <div id="hidden-inputs"></div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-outline" onclick="closeModal('dbModal')">Cancel</button>
                    <button type="submit" class="btn btn-black">Save Configuration</button>
                </div>
            </form>
        </div>
    </div>

    {{ db_properties|json_script:"db-properties" }}
    <script src="{% static 'core/script.js' %}"></script>
{% endblock %}
